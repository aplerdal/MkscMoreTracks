.gba
.open "mksc.gba", "MoreTracksPatch.gba", 0x08000000

.include "MoreTracksPatches.s"

.org 0x08400000
.byte 0x62, 0x38, 0x64, 0x30, 0x3A, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d
replace800b8d0:
	cmp r0, #0x0
	beq setMKSCTextVram
	cmp r0, #0x1
	beq setSMKTextVram
setMKSCTextVram:
	bl 0x8030434
	ldr r1, =0x02018000 ; textBufferMKSC
	ldr r2, =0x06010A00 ; vramAddrMKSC
	ldr r3, =0x80000100 ; sizeMKSC
	bl 0x080303e4
	b swapPage
setSMKTextVram:
	bl 0x8030434
	ldr r1, =0x02017c00 ; textBufferSMK
	ldr r2, =0x06010A00 ; vramAddrSMK
	ldr r3, =0x80000100 ;sizeSMK
	bl 0x080303e4
	b swapPage
.pool
swapPage:
	ldr r1, =0x11e4
	add r1, r8
	ldr r0, [r1,#0x0]
	cmp r0, #0x2
	bne nextPage
	mov r0, #0x0
	str r0, [r1, #0x0]
	b b8d0return
nextPage:
	add r0, r0, #0x1
	str r0, [r1, #0x0]
b8d0return:
	ldr r0, =0x0800B8D5 ; return address
	bx r0
.pool
.byte 0x32, 0x61, 0x61, 0x32, 0x3A, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d
; 2aa2 data
; Replace 2aa2 with a jump to this address
replace8002aa2:
	cmp r0, #0x0
	beq mksc
	cmp r0, #0x1
	beq smk
page3:
	mov r3, r10
	lsl r4, r3, #0x2
	add r0, r4, #0x0
	bl LoadTrackPg3
	b return2aa2
smk:
	mov r3, r10
	lsl r4, r3, #0x2
	add r0, r4, #0x0
	bl 0x08033bbc
	b return2aa2
mksc:
	mov r1, r10
	lsl r4, r1, #0x2
	add r0, r4, #0x0
	bl 0x8033bac
.align 2
return2aa2:
	ldr r1, =0x8002abc ; return address
	bx r1
.pool
LoadTrackPg3:
	ldr r1, =org(_trackOffsetTable)
	lsl r0, r0, #0x2
	add r0, r0, r1
	ldr r0, [r0,#0x0]
	bx lr
.pool
.align 4
.byte 0x67, 0x54, 0x72, 0x61, 0x63, 0x6B, 0x48, 0x65, 0x61, 0x64, 0x65, 0x72, 0x50, 0x67, 0x33, 0x2d
_trackOffsetTable:
.byte 0x04, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00 
.byte 0x0C, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00 
.byte 0x08, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00 
.byte 0x10, 0x00, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00 
.byte 0x17, 0x00, 0x00, 0x00, 0x15, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00 
.byte 0x1C, 0x00, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x00
.Close